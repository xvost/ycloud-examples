# Использование Ansible в Yandex Cloud
## Модуль Arenadata
### Установка

Модуль можно склонировать/скачать с официального репозитория
https://github.com/arenadata/ansible-module-yandex-cloud

Устанавливается в директории:
*  для одного пользователя: ~/.ansible/modules:
*  для всех пользователей: /usr/share/ansible/plugins/modules/
   
1. в module_utils копируем или делаем симлинк на файл yc.py
2. в modules так же заносим ycc_disk.py и ycc_vm.py

### Начало использования

В env файле указываем:
* Oauth токен или API-key, для авторизации в API
* Описываем конфигурации машин, которые будем создавать
* Добавляем данные для авторизации в глобальные переменные
* По вкусу и по необходимости добавляем шаблоны, переменные, ссылки и прочее

**PS** Стоит учитывать, что модуль работает только с API Compute Cloud, то есть он не может создать сеть/подсеть, получить ID образа. Такие данные стоит указывать сразу в конфигурации. Получить их можно в: UI, CLI, API.

### Использование

Функции модуля ограничены следующими операциями:
* Создание
* Обновление параметров
* Остановка
* Запуск
* Получение данных машины

Рассмотрим создание на примере плейбука init.yml
Из особенностей стоит отметить, что отключаем сразу сбор фактов об указанных хостах, так как перед их созданием вы не знаем о них ничего и откладываем этот процесс до момента успешного создания описанных машин.
Создание машин выносим в блок pre_tasks, чтобы процесс был запущен без привязки к указанным хостам.
Используя документацию модуля оформляем создание машин.

Oauth токен для идентификации в API указывается в виде списка полей:
```    
 auth:
       token: '{{ token }}'
```

В задаче создания регистрируем вывод модуля и достаём от туда публичный адрес, в случае работы из внешней сети в машинами, указываем его как ansible_host факт хоста и уже после этого собираем остальные факты с созданных машин.

Далее работаем с машинами, как обычно, так как данные у нас есть.

### Применяемость

С учётом особенностей и ограничения модуля его использование видится в тестировании, проверки конфигураций, так как построение инфраструктуры на отдельных машинах не является хорошим решением для прод окружения. # yandex-cloud-ansible
